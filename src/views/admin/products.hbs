<div class="container-fluid px-4">
    <h1 class="mt-4">Manager Products</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
        <li class="breadcrumb-item active">Products</li>
    </ol>
    <div id="search" class="row">
        <div class="form-group col-6">
            <label for="name">Name</label>
            <input type="text" name="name" class="form-control" id="name" placeholder="Enter name">
        </div>
        <div class="form-group col-6">
            <label for="description">Description</label>
            <input type="text" name="description" class="form-control" id="description" placeholder="Enter description">
        </div>
        <div class="form-group col-6">
            <label for="categoryId">Category</label>
            <select id="categoryId" name="categoryId" class="form-select">
                <option selected value="">Not set</option>
                {{#each categories}}
                <option value="{{this._id}}">{{this.name}}</option>
                {{/each}}
            </select>
        </div>
        <div class="form-group col-6">
            <label for="originalPrice">Original price</label>
            <input type="number" min="0" name="originalPrice" class="form-control" id="originalPrice"
                placeholder="Enter originalPrice">
        </div>
        <div class="form-group col-6">
            <label for="discountPrice">Discount price</label>
            <input type="number" min="0" name="discountPrice" class="form-control" id="discountPrice"
                placeholder="Enter discountPrice">
        </div>
        <div class="form-group col-6">
            <label for="tags">Tags</label>
            <input type="text" name="tags" class="form-control" id="tags" placeholder="Enter tags">
        </div>
        <div class="form-group col-6">
            <label for="stock">Stock</label>
            <input type="number" min="0" name="stock" class="form-control" id="stock" placeholder="Enter stock">
        </div>
        <div class="form-group col-6">
            <label for="ratings">Ratings</label>
            <input type="number" min="0" name="ratings" class="form-control" id="ratings" placeholder="Enter ratings">
        </div>
        <div class="form-group col-6">
            <label for="soldOut">Sold out</label>
            <input type="number" min="0" name="soldOut" class="form-control" id="soldOut" placeholder="Enter sold out">
        </div>
        <div class="form-group col-6">
            <label for="isDeleted">Is deleted</label>
            <select id="isDeleted" name="isDeleted" class="form-select">
                <option selected value="">All</option>
                <option value="false">False</option>
                <option value="true">True</option>
            </select>
        </div>
        <div class="form-group col-6">
            <label for="createdAt">Created at</label>
            <input type="text" name="createdAt" class="form-control" id="createdAt" placeholder="Enter created at">
        </div>
        <div class="form-group col-6">
            <label for="updatedAt">Updated at</label>
            <input type="text" name="updatedAt" class="form-control" id="updatedAt" placeholder="Enter updated at">
        </div>
        <div class="form-group col-6">
            <label for="createdBy">Created by</label>
            <select id="createdBy" name="createdBy" class="form-select">
                <option selected value="">Not set</option>
                {{#each users}}
                <option value="{{this._id}}">{{this.fullname}}-{{this.email}}</option>
                {{/each}}
            </select>
        </div>
        <div class="form-group col-6">
            <label for="Updated by">Updated by</label>
            <select id="updatedBy" name="updatedBy" class="form-select">
                <option selected value="">Not set</option>
                {{#each users}}
                <option value="{{this._id}}">{{this.fullname}}-{{this.email}}</option>
                {{/each}}
            </select>
        </div>
        <div class="form-group col-6">
            <label for="Deleted by">Deleted by</label>
            <select id="deletedBy" name="deletedBy" class="form-select">
                <option selected value="">Not set</option>
                {{#each users}}
                <option value="{{this._id}}">{{this.fullname}}-{{this.email}}</option>
                {{/each}}
            </select>
        </div>
    </div>
    <div class=" mb-1 mt-2">
        <button type="button" class="btn btn-primary btn-search">Search</button>
        <button type="button" class="btn btn-primary btn-add">Add</button>
        <button type="button" class="btn btn-primary btn-view">View</button>
        <button type="button" class="btn btn-primary btn-update">Update</button>
        <button type="button" class="btn btn-primary btn-delete">Delete</button>
        <button type="button" class="btn btn-primary btn-import">Import</button>
        <button type="button" class="btn btn-primary btn-export">Export</button>
    </div>
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-table me-1"></i>
            Products
        </div>
        <div class="card-body">
            <div class="input-group" style="width: 200px;">
                <div class="input-group-prepend">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">Per page</button>
                    <div class="dropdown-menu">
                        <div class="dropdown-item perPageItem">10</div>
                        <div class="dropdown-item perPageItem">50</div>
                        <div class="dropdown-item perPageItem">100</div>
                        <div class="dropdown-item perPageItem">200</div>
                        <div class="dropdown-item perPageItem">500</div>
                    </div>
                </div>
                <input id="perPage" type="number" name="perPage" min="1" value="10" class="form-control">
            </div>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th><input class="checkAll" type="checkbox"></th>
                        <th>Name</th>
                        <th>Original price</th>
                        <th>Discount price</th>
                        <th>Stock</th>
                        <th>Sout out</th>
                        <th>Is deleted</th>
                        <th>Created at</th>
                        <th>Updated at</th>
                    </tr>
                </thead>
                <tbody class="results">

                </tbody>
            </table>
            <ul class="pagination" style="display: flex; justify-content: flex-end;">

            </ul>
        </div>
    </div>
</div>
<div id="add" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="flex-direction: column; align-items: flex-start;">
                <h5 class="modal-title" id="exampleModalLongTitle">ADD PRODUCT</h5>
                <nav style="margin-bottom: -17px; margin-top: 12px;">
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active" id="add-nav-1-tab" data-bs-toggle="tab"
                            data-bs-target="#add-nav-1" type="button" role="tab" aria-controls="add-nav-1"
                            aria-selected="true">Information</button>
                        <button class="nav-link" id="add-nav-2-tab" data-bs-toggle="tab" data-bs-target="#add-nav-2"
                            type="button" role="tab" aria-controls="add-nav-2"
                            aria-selected="false">Description</button>
                        <button class="nav-link" id="add-nav-3-tab" data-bs-toggle="tab" data-bs-target="#add-nav-3"
                            type="button" role="tab" aria-controls="add-nav-3" aria-selected="false">Images</button>
                    </div>
                </nav>
            </div>
            <div class="modal-body">
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="add-nav-1" role="tabpanel"
                        aria-labelledby="add-nav-1-tab">
                        <div class="row">
                            <div class="form-group col-6">
                                <label for="name">Name</label>
                                <input type="text" name="name" class="form-control" id="name" placeholder="Enter name">
                            </div>
                            <div class="form-group col-6">
                                <label for="categoryId">Category</label>
                                <select id="categoryId" name="categoryId" class="form-select">
                                    <option selected value="">Not set</option>
                                    {{#each categories}}
                                    <option value="{{this._id}}">{{this.name}}</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="form-group col-6">
                                <label for="originalPrice">Original price</label>
                                <input type="number" min="0" name="originalPrice" class="form-control"
                                    id="originalPrice" placeholder="Enter original price">
                            </div>
                            <div class="form-group col-6">
                                <label for="discountPrice">Discount price</label>
                                <input type="number" min="0" name="discountPrice" class="form-control"
                                    id="discountPrice" placeholder="Enter discount price">
                            </div>
                            <div class="form-group col-6">
                                <label for="tags">Tags</label>
                                <input type="text" name="tags" class="form-control" id="tags" placeholder="Enter tags">
                            </div>
                            <div class="form-group col-6">
                                <label for="stock">Stock</label>
                                <input type="number" min="0" name="stock" class="form-control" id="stock"
                                    placeholder="Enter stock">
                            </div>
                            <div class="form-group col-6">
                                <label for="ratings">Ratings</label>
                                <input type="number" min="0" name="ratings" class="form-control" id="ratings"
                                    placeholder="Enter ratings">
                            </div>
                            <div class="form-group col-6">
                                <label for="soldOut">Sold out</label>
                                <input type="number" min="0" name="soldOut" class="form-control" id="soldOut"
                                    placeholder="Enter sold out">
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="add-nav-2" role="tabpanel" aria-labelledby="add-nav-2-tab">
                        <div class="row">
                            <div class="form-group col-12">
                                <label for="description">Description</label>
                                <textarea type="text" name="description" class="form-control" id="description" rows="8"
                                    placeholder="Enter description"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="add-nav-3" role="tabpanel" aria-labelledby="add-nav-3-tab">
                        //Insert images here
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-add-cancel" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btn-add-save">Save</button>
            </div>
        </div>
    </div>
</div>
<div id="view" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="flex-direction: column; align-items: flex-start;">
                <h5 class="modal-title" id="exampleModalLongTitle">VIEW PRODUCT</h5>
                <nav style="margin-bottom: -17px; margin-top: 12px;">
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active" id="view-nav-1-tab" data-bs-toggle="tab"
                            data-bs-target="#view-nav-1" type="button" role="tab" aria-controls="view-nav-1"
                            aria-selected="true">Information</button>
                        <button class="nav-link" id="view-nav-2-tab" data-bs-toggle="tab" data-bs-target="#view-nav-2"
                            type="button" role="tab" aria-controls="view-nav-2"
                            aria-selected="false">Description</button>
                        <button class="nav-link" id="view-nav-3-tab" data-bs-toggle="tab" data-bs-target="#view-nav-3"
                            type="button" role="tab" aria-controls="view-nav-3" aria-selected="false">Images</button>
                    </div>
                </nav>
            </div>
            <div class="modal-body">
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="view-nav-1" role="tabpanel"
                        aria-labelledby="view-nav-1-tab">
                        <div class="row">
                            <div class="form-group col-6">
                                <label for="name">Name</label>
                                <input type="text" disabled name="name" class="form-control" id="name">
                            </div>
                            <div class="form-group col-6">
                                <label for="categoryId">Category</label>
                                <input type="text" min="0" disabled name="categoryId" class="form-control"
                                    id="categoryId">
                            </div>
                            <div class="form-group col-6">
                                <label for="originalPrice">Original price</label>
                                <input type="number" min="0" disabled name="originalPrice" class="form-control"
                                    id="originalPrice">
                            </div>
                            <div class="form-group col-6">
                                <label for="discountPrice">Discount price</label>
                                <input type="number" min="0" disabled name="discountPrice" class="form-control"
                                    id="discountPrice">
                            </div>
                            <div class="form-group col-6">
                                <label for="tags">Tags</label>
                                <input type="text" name="tags" disabled class="form-control" id="tags">
                            </div>
                            <div class="form-group col-6">
                                <label for="stock">Stock</label>
                                <input type="number" min="0" disabled name="stock" class="form-control" id="stock">
                            </div>
                            <div class="form-group col-6">
                                <label for="ratings">Ratings</label>
                                <input type="number" min="0" disabled name="ratings" class="form-control" id="ratings">
                            </div>
                            <div class="form-group col-6">
                                <label for="soldOut">Sold out</label>
                                <input type="number" min="0" disabled name="soldOut" class="form-control" id="soldOut">
                            </div>
                            <div class="form-group col-6">
                                <label for="isDeleted">Is deleted</label>
                                <input type="text" min="0" disabled name="isDeleted" class="form-control"
                                    id="isDeleted">
                            </div>
                            <div class="form-group col-6">
                                <label for="createdAt">Created at</label>
                                <input type="text" disabled name="createdAt" class="form-control" id="createdAt">
                            </div>
                            <div class="form-group col-6">
                                <label for="updatedAt">Updated at</label>
                                <input type="text" disabled name="updatedAt" class="form-control" id="updatedAt">
                            </div>
                            <div class="form-group col-6">
                                <label for="createdBy">Created by</label>
                                <input type="text" disabled name="createdBy" class="form-control" id="createdBy">
                            </div>
                            <div class="form-group col-6">
                                <label for="updatedBy">Updated by</label>
                                <input type="text" disabled name="updatedBy" class="form-control" id="updatedBy">
                            </div>
                            <div class="form-group col-6">
                                <label for="deletedBy">Deleted by</label>
                                <input type="text" disabled name="deletedBy" class="form-control" id="deletedBy">
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="view-nav-2" role="tabpanel" aria-labelledby="view-nav-2-tab">
                        <div class="row">
                            <div class="form-group col-12">
                                <label for="description">Description</label>
                                <textarea type="text" disabled name="description" class="form-control" id="description"
                                    rows="8"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="view-nav-3" role="tabpanel" aria-labelledby="view-nav-3-tab">
                        //Insert images here
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-view-cancel" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btn-view-save">Save</button>
            </div>
        </div>
    </div>
</div>
<div id="update" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="flex-direction: column; align-items: flex-start;">
                <h5 class="modal-title" id="exampleModalLongTitle">UPDATE PRODUCT</h5>
                <nav style="margin-bottom: -17px; margin-top: 12px;">
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <button class="nav-link active" view-id="update-nav-1-tab" data-bs-toggle="tab"
                            data-bs-target="#update-nav-1" type="button" role="tab" aria-controls="update-nav-1"
                            aria-selected="true">Information</button>
                        <button class="nav-link" id="update-nav-2-tab" data-bs-toggle="tab"
                            data-bs-target="#update-nav-2" type="button" role="tab" aria-controls="update-nav-2"
                            aria-selected="false">Description</button>
                        <button class="nav-link" view-id="update-nav-3-tab" data-bs-toggle="tab"
                            data-bs-target="#update-nav-3" type="button" role="tab" aria-controls="update-nav-3"
                            aria-selected="false">Images</button>
                    </div>
                </nav>
            </div>
            <div class="modal-body">
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="update-nav-1" role="tabpanel"
                        aria-labelledby="update-nav-1-tab">
                        <div class="row">
                            <div class="form-group col-6">
                                <label for="name">Name</label>
                                <input type="text" name="name" class="form-control" id="name" placeholder="Enter name">
                            </div>
                            <div class="form-group col-6">
                                <label for="categoryId">Category</label>
                                <select id="categoryId" name="categoryId" class="form-select">
                                    <option selected value="">Not set</option>
                                    {{#each categories}}
                                    <option value="{{this._id}}">{{this.name}}</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="form-group col-6">
                                <label for="originalPrice">Original price</label>
                                <input type="number" min="0" name="originalPrice" class="form-control"
                                    id="originalPrice" placeholder="Enter original price">
                            </div>
                            <div class="form-group col-6">
                                <label for="discountPrice">Discount price</label>
                                <input type="number" min="0" name="discountPrice" class="form-control"
                                    id="discountPrice" placeholder="Enter discount price">
                            </div>
                            <div class="form-group col-6">
                                <label for="tags">Tags</label>
                                <input type="text" name="tags" class="form-control" id="tags" placeholder="Enter tags">
                            </div>
                            <div class="form-group col-6">
                                <label for="stock">Stock</label>
                                <input type="number" min="0" name="stock" class="form-control" id="stock"
                                    placeholder="Enter stock">
                            </div>
                            <div class="form-group col-6">
                                <label for="ratings">Ratings</label>
                                <input type="number" min="0" name="ratings" class="form-control" id="ratings"
                                    placeholder="Enter ratings">
                            </div>
                            <div class="form-group col-6">
                                <label for="soldOut">Sold out</label>
                                <input type="number" min="0" name="soldOut" class="form-control" id="soldOut"
                                    placeholder="Enter sold out">
                            </div>
                            <div class="form-group col-6">
                                <label for="isDeleted">Is deleted</label>
                                <select id="isDeleted" name="isDeleted" class="form-select">
                                    <option selected value="">All</option>
                                    <option value="false">False</option>
                                    <option value="true">True</option>
                                </select>
                            </div>
                            <div class="form-group col-6">
                                <label for="createdAt">Created at</label>
                                <input type="text" disabled name="createdAt" class="form-control" id="createdAt">
                            </div>
                            <div class="form-group col-6">
                                <label for="updatedAt">Updated at</label>
                                <input type="text" disabled name="updatedAt" class="form-control" id="updatedAt">
                            </div>
                            <div class="form-group col-6">
                                <label for="createdBy">Created by</label>
                                <input type="text" disabled name="createdBy" class="form-control" id="createdBy">
                            </div>
                            <div class="form-group col-6">
                                <label for="updatedBy">Updated by</label>
                                <input type="text" disabled name="updatedBy" class="form-control" id="updatedBy">
                            </div>
                            <div class="form-group col-6">
                                <label for="deletedBy">Deleted by</label>
                                <input type="text" disabled name="deletedBy" class="form-control" id="deletedBy">
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="update-nav-2" role="tabpanel" aria-labelledby="update-nav-2-tab">
                        <div class="row">
                            <div class="form-group col-12">
                                <label for="description">Description</label>
                                <textarea type="text" name="description" class="form-control" id="description" rows="8"
                                    placeholder="Enter description"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="update-nav-3" role="tabpanel" aria-labelledby="update-nav-3-tab">
                        //Insert images here
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-update-cancel" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btn-update-save">Save</button>
            </div>
        </div>
    </div>
</div>
<div id="delete" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">DELETE PRODUCTS</h5>
            </div>
            <div class="modal-body row">
                <p>Are you sure to delete these products? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-delete-cancel" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger btn-delete-save">Confirm</button>
            </div>
        </div>
    </div>
</div>
<div id="import" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">IMPORT PRODUCTS</h5>
            </div>
            <div class="modal-body row">
                <div class="form-group col-6">
                    <label for="name">File</label>
                    <input type="file"
                        accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                        name="file" class="form-control" id="file">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-import-cancel" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btn-import-save">Confirm</button>
            </div>
        </div>
    </div>
</div>
<div id="export" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">EXPORT PRODUCTS</h5>
            </div>
            <div class="modal-body row">
                <div class="form-group col-12">
                    You want to export all products or only products in current page?
                </div>
                <div class="form-group col-6">
                    <label for="type">Type</label>
                    <select id="type" name="type" class="form-select">
                        <option value="all">All</option>
                        <option value="currentPage">Current Page</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-export-cancel" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btn-export-save">Confirm</button>
            </div>
        </div>
    </div>
</div>
<script>
    const USDollar = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
    });
    const search = async (query = {}) => {
        let params = "";
        for (let key in query) {
            if (!!query[key]) {
                params += `${key}=${query[key]}&`;
            }
        }
        const pagination = await fetch(`/admin/products/search?${params}`).then(res => res.json());
        return pagination;
    }
    const updateTable = (products) => {
        const tbody = $("tbody.results");
        tbody.empty();
        products.forEach(user => {
            tbody.append(`
                <tr>
                    <td><input class="checkItem" value="${user._id}" type="checkbox"></td>
                    <td>${user.name}</td>
                    <td>${USDollar.format(user.originalPrice) || ""}</td>
                    <td>${USDollar.format(user.discountPrice) || ""}</td>
                    <td>${user.stock || ""}</td>
                    <td>${user.soldOut || ""}</td>
                    <td>${user.isDeleted}</td>
                    <td>${!!user.createdAt ? moment(user.createdAt).format('DD/MM/YY HH:mm') : ""}</td>
                    <td>${!!user.updatedAt ? moment(user.updatedAt).format('DD/MM/YY HH:mm') : ""}</td>
                </tr>
            `);
        });
    }
    const updatePagination = (totalPage = 0, page = 1) => {
        const paginationTag = $(".pagination");
        paginationTag.empty();
        if (page > 1) {
            paginationTag.append(`<li class="page-item page-preview "><div class="page-link">Previous</div></li>`);
        } else {
            paginationTag.append(`<li class="page-item page-preview disabled"><div class="page-link">Previous</div></li>`);
        }
        for (let i = 1; i <= totalPage; i++) {
            if (i == page) {
                paginationTag.append(`<li class="page-item page-item-number active"><div class="page-link" >${i}</div></li>`);
            } else {
                paginationTag.append(`<li class="page-item page-item-number"><div class="page-link" >${i}</div></li>`);
            }
        }
        if (page < totalPage) {
            paginationTag.append(`<li class="page-item page-next"><div class="page-link" >Next</div></li>`);
        } else {
            paginationTag.append(`<li class="page-item page-next disabled"><div class="page-link" >Next</div></li>`);
        }
    }
    const clearInputs = (parrentId) => {
        $(`#${parrentId} input`).val("");
        $(`#${parrentId} select`).val("");
    }

    $(document).ready(async function () {
        $('input[name="createdAt"]').daterangepicker({
            autoUpdateInput: false,
            locale: {
                cancelLabel: 'Clear',
                format: 'DD/MM/YYYY',
            }
        });
        $('input[name="createdAt"]').on('apply.daterangepicker', function (ev, picker) {
            $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
        });
        $('input[name="createdAt"]').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });
        $('input[name="updatedAt"]').daterangepicker({
            autoUpdateInput: false,
            locale: {
                cancelLabel: 'Clear',
                format: 'DD/MM/YYYY',
            }
        });
        $('input[name="updatedAt"]').on('apply.daterangepicker', function (ev, picker) {
            $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
        });

        $('input[name="updatedAt"]').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });

        const pagination = await search();
        const { totalPage = 0, page = 1, data = [] } = pagination;
        updateTable(data);
        updatePagination(totalPage, page);

        $(".checkAll").click(function () {
            $('input:checkbox').not(this).prop('checked', this.checked);
        });
        $(".checkItem").click(function () {
            const checkAll = $(".checkItem").toArray().every(item => item.checked);
            $(".checkAll").prop('checked', checkAll);
        });
        $(".perPageItem").click(async function () {
            const perPage = $(this).text();
            $("#perPage").val(perPage);
            searchAction();
        });
        $("#perPage").on("input", async function () {
            const perPage = $(this).val();
            searchAction();
        });
        $(".pagination").on("click", ".page-next", async function () {
            const currentPage = Number.parseInt($(".pagination .active").text()) || 1;
            $(".pagination .active").removeClass("active");
            $(`.pagination .page-item-number`)[currentPage].classList.add("active");
            searchAction();
        });
        $(".pagination").on("click", ".page-preview", async function () {
            const currentPage = $(".pagination .active").text() || 2;
            $(".pagination .active").removeClass("active");
            $(`.pagination .page-item-number`)[currentPage - 2].classList.add("active");
            searchAction();
        });
        $(".pagination").on("click", ".page-item-number", async function () {
            $(".pagination .active").removeClass("active");
            $(this).addClass("active");
            searchAction();
        });
        const searchAction = async function () {
            const name = $("#search #name").val();
            const description = $("#search #description").val();
            const categoryId = $("#search #categoryId").val();
            const originalPrice = $("#search #originalPrice").val();
            const discountPrice = $("#search #discountPrice").val();
            const tags = $("#search #tags").val();
            const stock = $("#search #stock").val();
            const ratings = $("#search #ratings").val();
            const soldOut = $("#search #soldOut").val();
            const isDeleted = $("#search #isDeleted").val();
            const createdAt = $("#search #createdAt").val();
            const updatedAt = $("#search #updatedAt").val();
            const deltedBy = $("#search #deletedBy").val();
            const perPage = $("#perPage").val() || 10;
            const currentPage = $(".pagination .active").text() || 1;
            const query = {
                name,
                description,
                categoryId,
                originalPrice,
                discountPrice,
                tags,
                stock,
                ratings,
                soldOut,
                isDeleted,
                createdAt,
                updatedAt,
                deltedBy,
                limit: perPage,
                page: currentPage
            };
            const pagination = await search(query);
            const { totalPage = 0, page = 1, data = [] } = pagination;
            updateTable(data);
            updatePagination(totalPage, page);
        };
        $(".btn-search").click(searchAction);
        $(".btn-add").click(function () {
            $("#add").modal("show");
        });
        $(".btn-add-cancel").click(function () {
            $("#add").modal("hide");
        });
        $(".btn-add-save").click(async function () {
            const name = $("#add #name").val();
            const description = $("#add #description").val();
            const categoryId = $("#add #categoryId").val();
            const originalPrice = $("#add #originalPrice").val();
            const discountPrice = $("#add #discountPrice").val();
            const tags = $("#add #tags").val();
            const stock = $("#add #stock").val();
            const ratings = $("#add #ratings").val();
            const soldOut = $("#add #soldOut").val();
            const body = {
                name,
                description,
                categoryId: categoryId == "" ? null : categoryId,
                originalPrice,
                discountPrice,
                tags,
                stock,
                ratings,
                soldOut,
            };
            const res = await fetch("/admin/products", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(body)
            }).then(res => res.json());
            clearInputs("add");
            if (res.errorCode == 0) {
                $("#add").modal("hide");
                const pagination = await search();
                const { totalPage = 0, page = 1, data = [] } = pagination;
                updateTable(data);
                updatePagination(totalPage, page);
            } else {
                alert(res.message);
            }
        });
        $(".btn-view").click(async function () {
            const checkedItems = $(".checkItem:checked").toArray();
            if (checkedItems.length == 0) {
                alert("Please choose at least one item");
                return;
            }
            if (checkedItems.length > 1) {
                alert("Please choose only one item");
                return;
            }
            const id = checkedItems[0].value;
            const product = await fetch(`/admin/products/search/${id}`).then(res => res.json());
            $("#view #name").val(product.name);
            $("#view #description").val(product.description);
            $("#view #categoryId").val(product.categoryObj?.name || "");
            $("#view #originalPrice").val(product.originalPrice);
            $("#view #discountPrice").val(product.discountPrice);
            $("#view #tags").val(product.tags);
            $("#view #stock").val(product.stock);
            $("#view #ratings").val(product.ratings);
            $("#view #soldOut").val(product.soldOut);
            $("#view #isDeleted").val(`${product.isDeleted}`);
            $("#view #createdAt").val(!!product.createdAt ? moment(product.createdAt).format('DD/MM/YY HH:mm') : "");
            $("#view #updatedAt").val(!!product.updatedAt ? moment(product.updatedAt).format('DD/MM/YY HH:mm') : "");
            $("#view #createdBy").val(!!product.createdByObj ? `${product.createdByObj?.fullname}-${product.createdByObj?.email}` : "");
            $("#view #updatedBy").val(!!product.updatedByObj ? `${product.updatedByObj?.fullname}-${product.updatedByObj?.email}` : "");
            $("#view #deletedBy").val(!!product.deletedByObj ? `${product.deletedByObj?.fullname}-${product.deletedByObj?.email}` : "");
            $("#view").modal("show");
        });
        $(".btn-update").click(async function () {
            const checkedItems = $(".checkItem:checked").toArray();
            if (checkedItems.length == 0) {
                alert("Please choose at least one item");
                return;
            }
            if (checkedItems.length > 1) {
                alert("Please choose only one item");
                return;
            }
            const id = checkedItems[0].value;
            const product = await fetch(`/admin/products/search/${id}`).then(res => res.json());
            $("#update #name").val(product.name);
            $("#update #description").val(product.description);
            $("#update #categoryId").val(product.categoryId);
            $("#update #originalPrice").val(product.originalPrice);
            $("#update #discountPrice").val(product.discountPrice);
            $("#update #tags").val(product.tags);
            $("#update #stock").val(product.stock);
            $("#update #ratings").val(product.ratings);
            $("#update #soldOut").val(product.soldOut);
            $("#update #isDeleted").val(`${product.isDeleted}`);
            $("#update #createdAt").val(!!product.createdAt ? moment(product.createdAt).format('DD/MM/YY HH:mm') : "");
            $("#update #updatedAt").val(!!product.updatedAt ? moment(product.updatedAt).format('DD/MM/YY HH:mm') : "");
            $("#update #createdBy").val(!!product.createdByObj ? `${product.createdByObj?.fullname}-${product.createdByObj?.email}` : "");
            $("#update #updatedBy").val(!!product.updatedByObj ? `${product.updatedByObj?.fullname}-${product.updatedByObj?.email}` : "");
            $("#update #deletedBy").val(!!product.deletedByObj ? `${product.deletedByObj?.fullname}-${product.deletedByObj?.email}` : "");
            $("#update").modal("show");
        });
        $(".btn-update-cancel").click(function () {
            $("#update").modal("hide");
        });
        $(".btn-update-save").click(async function () {
            const checkedItems = $(".checkItem:checked").toArray();
            const id = checkedItems[0].value;
            const name = $("#update #name").val();
            const description = $("#update #description").val();
            const categoryId = $("#update #categoryId").val();
            const originalPrice = $("#update #originalPrice").val();
            const discountPrice = $("#update #discountPrice").val();
            const tags = $("#update #tags").val();
            const stock = $("#update #stock").val();
            const ratings = $("#update #ratings").val();
            const soldOut = $("#update #soldOut").val();
            const isDeleted = $("#update #isDeleted").val();
            const body = {
                id,
                name,
                description,
                categoryId: categoryId == "" ? null : categoryId,
                originalPrice,
                discountPrice,
                tags,
                stock,
                ratings,
                soldOut,
                isDeleted
            };
            const res = await fetch(`/admin/products`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(body)
            }).then(res => res.json());
            clearInputs("update");
            if (res.errorCode == 0) {
                $("#update").modal("hide");
                const pagination = await search();
                const { totalPage = 0, page = 1, data = [] } = pagination;
                updateTable(data);
                updatePagination(totalPage, page);
            } else {
                alert(res.message);
            }
        });
        $(".btn-delete").click(function () {
            const checkedItems = $(".checkItem:checked").toArray();
            if (checkedItems.length == 0) {
                alert("Please choose at least one item");
                return;
            }
            $("#delete").modal("show");
        });
        $(".btn-delete-cancel").click(function () {
            $("#delete").modal("hide");
        });
        $(".btn-delete-save").click(async function () {
            const checkedItems = $(".checkItem:checked").toArray();
            const ids = checkedItems.map(item => item.value);
            const body = {
                ids
            };
            const res = await fetch(`/admin/products`, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(body)
            }).then(res => res.json());
            if (res.errorCode == 0) {
                $("#delete").modal("hide");
                const pagination = await search();
                const { totalPage = 0, page = 1, data = [] } = pagination;
                updateTable(data);
                updatePagination(totalPage, page);
            } else {
                alert(res.message);
            }
        });
        $(".btn-import").click(function () {
            $("#import").modal("show");
        });
        $(".btn-import-cancel").click(function () {
            $("#import").modal("hide");
        });
        $(".btn-import-save").click(async function () {
            const file = $("#import #file").val();
            if (!file) {
                alert("Please choose file");
                return;
            }
            //do to import user
            $("#import").modal("hide");
        });
        $(".btn-export").click(function () {
            $("#export").modal("show");
        });
        $(".btn-export-cancel").click(function () {
            $("#export").modal("hide");
        });
        $(".btn-export-save").click(async function () {
            const type = $("#export #type").val();
            if (type == "all") {
                //do to export all
            } else {
                //do to export current page
            }
            $("#export").modal("hide");
        });
    });
</script>